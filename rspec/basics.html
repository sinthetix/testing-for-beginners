<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Testing for Beginners">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="google-site-verification" content="BEd2YAbpSQrRqU2-5wUifTTzvqTMGLLE269b0JZTfCs" />

    <title>Basic Usage | Testing for Beginners</title>

    <link href="../assets/stylesheets/monstas-fe625f69.css" rel="stylesheet" type="text/css" />
  </head>

  <body>
    <nav class="page-nav"><a class="prev" href="/rspec.html">
  Previous
</a></nav>
    <nav class="page-nav"><a class="next" href="/rspec/matchers.html">
  Next
</a></nav>

    <div>
      <nav class="toc">
        <h1>Contents</h1>
        <ul>
  <li>
    <a href="/index.html">
      Testing For Beginners
    </a>
  </li>
  <li>
    <a href="/preface.html">
      Preface
    </a>
  </li>
  <li class="directory">
    <a href="/testing.html">
      Testing Code
    </a>
    <ul>
      <li>
        <a href="/testing/output.html">
          Testing via output
        </a>
      </li>
      <li>
        <a href="/testing/separation.html">
          Separating test code
        </a>
      </li>
      <li>
        <a href="/testing/computed.html">
          Computed tests
        </a>
      </li>
      <li>
        <a href="/testing/assert.html">
          Assertions
        </a>
      </li>
      <li>
        <a href="/testing/stages.html">
          Stages of a test
        </a>
      </li>
      <li>
        <a href="/testing/classes.html">
          Test Classes
        </a>
      </li>
    </ul>
  </li>
  <li>
    <a href="/libraries.html">
      Libraries
    </a>
  </li>
  <li>
    <a href="/minitest.html">
      Minitest
    </a>
  </li>
  <li class="directory expanded">
    <a href="/rspec.html">
      RSpec
    </a>
    <ul>
      <li class="active">
        <a href="/rspec/basics.html">
          Basic Usage
        </a>
      </li>
      <li>
        <a href="/rspec/matchers.html">
          Matchers
        </a>
      </li>
      <li>
        <a href="/rspec/format.html">
          Format
        </a>
      </li>
      <li>
        <a href="/rspec/advanced.html">
          Advanced Usage
        </a>
      </li>
      <li>
        <a href="/rspec/custom_matchers.html">
          Custom Matchers
        </a>
      </li>
      <li>
        <a href="/rspec/filtering.html">
          Filtering
        </a>
      </li>
    </ul>
  </li>
  <li class="directory">
    <a href="/rack_test.html">
      Rack::Test
    </a>
    <ul>
      <li>
        <a href="/rack_test/rack.html">
          Testing a Rack app
        </a>
      </li>
      <li>
        <a href="/rack_test/sinatra.html">
          Testing a Sinatra app
        </a>
      </li>
    </ul>
  </li>
  <li class="directory">
    <a href="/headless.html">
      Headless browsers
    </a>
    <ul>
      <li>
        <a href="/headless/phantomjs.html">
          Phantom.js
        </a>
      </li>
      <li>
        <a href="/headless/capybara.html">
          Capybara
        </a>
      </li>
      <li>
        <a href="/headless/features.html">
          Feature tests
        </a>
      </li>
    </ul>
  </li>
  <li>
    <a href="/test_doubles.html">
      Test doubles
    </a>
  </li>
  <li>
    <a href="/analysis.html">
      Code Analysis
    </a>
  </li>
  <li>
    <a href="/services.html">
      Services
    </a>
  </li>
</ul>
      </nav>
      <article>
        <nav class="menu"><a href="#"></a></nav>
        <h1>Basic Usage</h1>

<p>RSpec tests can be written in several flavors, or styles. Let&rsquo;s have a look at
the most basic one first.</p>

<p>RSpec wants us to define tests in a file that ends with <code>_spec.rb</code>, so we store
both our class and our test in the file <code>user_spec.rb</code>. Normally, in modern
code bases, you&rsquo;d store your code in one file, and your tests in another file:</p>
<pre class="highlight ruby"><code><span class="nb">require</span> <span class="s2">"date"</span>

<span class="k">def</span> <span class="nf">leap_year?</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
  <span class="n">year</span> <span class="o">%</span> <span class="mi">400</span> <span class="o">==</span> <span class="mi">0</span> <span class="n">or</span> <span class="n">year</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">!=</span> <span class="mi">0</span> <span class="n">and</span> <span class="n">year</span> <span class="o">%</span> <span class="mi">4</span> <span class="o">==</span> <span class="mi">0</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">User</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="n">birthday</span><span class="p">)</span>
    <span class="vi">@name</span> <span class="o">=</span> <span class="nb">name</span>
    <span class="vi">@birthday</span> <span class="o">=</span> <span class="n">birthday</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">name</span>
    <span class="vi">@name</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">born_in_leap_year?</span>
    <span class="n">leap_year?</span><span class="p">(</span><span class="no">Date</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="vi">@birthday</span><span class="p">).</span><span class="nf">year</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">describe</span> <span class="no">User</span> <span class="k">do</span>
  <span class="n">it</span> <span class="s2">"is born in a leap year when born in 2000"</span> <span class="k">do</span>
    <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"Francisca"</span><span class="p">,</span> <span class="s2">"2000-01-01"</span><span class="p">)</span>
    <span class="n">actual</span> <span class="o">=</span> <span class="n">user</span><span class="p">.</span><span class="nf">born_in_leap_year?</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="kp">true</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">actual</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span> <span class="n">expected</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<p>Does that read ok?</p>

<p>We&rsquo;re going to work with this test more later, so let&rsquo;s shorten that a bit and
use less space, by removing the <code>actual</code> and <code>expected</code> variables:</p>
<pre class="highlight ruby"><code><span class="n">describe</span> <span class="no">User</span> <span class="k">do</span>
  <span class="n">it</span> <span class="s2">"is born in a leap year when born in 2000"</span> <span class="k">do</span>
    <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"Francisca"</span><span class="p">,</span> <span class="s2">"2000-01-01"</span><span class="p">)</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="nf">born_in_leap_year?</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span> <span class="kp">true</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<p>Ok. That&rsquo;s the same, but uses 2 lines instead of 4.</p>

<p>Remember how Sinatra is a <a href="http://webapps-for-beginners.rubymonstas.org/sinatra/dsl.html">DSL</a>,
a language, for &ldquo;talking&rdquo; about (writing code that deals with) the problem
domain of HTTP, i.e. writing web applications?</p>

<p>RSpec is a DSL for the problem domain of writing tests (or &ldquo;specifications&rdquo;).</p>

<p>While Sinatra defines methods such as <code>get</code>, <code>post</code>, <code>status</code>, <code>redirect</code>, and
so on, RSpec defines methods like <code>describe</code>, <code>it</code>, <code>expect</code>, and <code>eq</code> (equal).</p>

<p>Using these methods we can describe our expectations about our code, and
execute them. In RSpec&rsquo;s thinking, that&rsquo;s what tests are all about: expressing
our expectations about the behaviour of our code. We <em>describe</em> the class
<code>User</code>, and specify our expectations.</p>

<p>Instead of <code>it</code> you can also use <code>example</code>. That&rsquo;s exactly the same:</p>
<pre class="highlight ruby"><code><span class="n">describe</span> <span class="no">User</span> <span class="k">do</span>
  <span class="n">example</span> <span class="s2">"is born in a leap year when born in 2000"</span> <span class="k">do</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<p>Also, suppose we have many tests that deal with the case that a user was
born in 2000, maybe like this:</p>
<pre class="highlight ruby"><code><span class="n">describe</span> <span class="no">User</span> <span class="k">do</span>
  <span class="n">it</span> <span class="s2">"is born in a leap year when born in 2000"</span> <span class="k">do</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s2">"is at voting age when born in 2000"</span> <span class="k">do</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<p>RSpec allows us to group such tests (examples) like so:</p>
<pre class="highlight ruby"><code><span class="n">describe</span> <span class="no">User</span> <span class="k">do</span>
  <span class="n">describe</span> <span class="s2">"when born in 2000"</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">"is born in a leap year"</span> <span class="k">do</span>
      <span class="c1"># ...</span>
    <span class="k">end</span>

    <span class="n">example</span> <span class="s2">"is at voting age"</span> <span class="k">do</span>
      <span class="c1"># ...</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<p>And again, there&rsquo;s an alias for nested <code>describe</code> blocks: You can use <code>context</code>
there, too:</p>
<pre class="highlight ruby"><code><span class="n">describe</span> <span class="no">User</span> <span class="k">do</span>
  <span class="n">context</span> <span class="s2">"when born in 2000"</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">"is born in a leap year"</span> <span class="k">do</span>
      <span class="c1"># ...</span>
    <span class="k">end</span>

    <span class="n">example</span> <span class="s2">"is at voting age"</span> <span class="k">do</span>
      <span class="c1"># ...</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<p>Nice, isn&rsquo;t it? Our spec says: &ldquo;A user, in the context of being born in 2000,
is born in a leap year&rdquo;, and then &ldquo;[in the same context] is at voting age&rdquo;.</p>

<p>In short the methods <code>describe</code> and <code>context</code> are used to set up a logical
structure for your tests. There needs to be at least one top level <code>describe</code>
block. This is the equivalent to defining a class that inherits from
<code>Minitest::Test</code>.</p>

<p>The method <code>it</code> (or one of its alias <code>example</code> and <code>specify</code>) is then used to
add the actual tests, i.e. that&rsquo;s the equivalent to defining methods that start
with <code>test_</code> in Minitest.</p>

<p>Under the hood RSpec uses a lot of <a href="http://rubylearning.com/blog/2010/11/23/dont-know-metaprogramming-in-ruby/">metaprogramming</a>.
I.e. RSpec has methods that, when called, define code, classes and methods,
according to the arguments you pass. For example the code <code>describe User do ...
end</code> defines a class, and methods like <code>context</code>, and <code>it</code> add more code to
this class. RSpec then, eventually, executes this code automatically, and runs
your tests.</p>

<p>That means, even though you&rsquo;re very familiar with Ruby, you&rsquo;ll still need to
learn RSpec in order to use it effectively. That&rsquo;s one of the reasons why some
Ruby developers dislike RSpec: It&rsquo;s not &ldquo;just Ruby&rdquo; any more. On the flip side,
it&rsquo;s extremely powerful, and comes with features that no other testing library
has.</p>

<p>When you run the code in our <code>user_spec.rb</code> file, the output will look
something like this:</p>
<pre class="highlight plaintext"><code>$ rspec user_spec.rb
.

Finished in 0.00204 seconds (files took 0.1559 seconds to load)
1 example, 0 failures
</code></pre>

<p>The dot indicates that there is exactly one test defined. RSpec calls tests
&ldquo;examples&rdquo;. That&rsquo;s because they like to stress that tests shouldn&rsquo;t be so much
about technical details, but about the behavior that the user cares about.
They like to say that we &ldquo;specify&rdquo; behavior by the way of defining
&ldquo;examples&rdquo;.</p>

<p>Let&rsquo;s break our test, and change the method <code>born_in_leap_year?</code> to always
return <code>false</code>:</p>
<pre class="highlight ruby"><code>  <span class="k">def</span> <span class="nf">born_in_leap_year?</span>
    <span class="kp">false</span>
  <span class="k">end</span>
</code></pre>

<p>When you now run the code again the output will look like this:</p>
<pre class="highlight plaintext"><code>$ rspec user_spec.rb
F

Failures:

  1) User born in 2000 is born in a leap year
     Failure/Error: expect(user.born_in_leap_year?).to eq true

       expected: true
            got: false

       (compared using ==)
     # ./user_spec.rb:25:in `block (3 levels) in &lt;top (required)&gt;'

Finished in 0.02033 seconds (files took 0.15813 seconds to load)
1 example, 1 failure

Failed examples:

rspec ./user_spec.rb:23 # User born in 2000 is born in a leap year
</code></pre>

<p>Wow, that&rsquo;s pretty comprehensive. RSpec tells us exactly what&rsquo;s going wrong,
and where. So nice of them.</p>

        <nav class="page-nav"><a class="prev" href="/rspec.html">
  Previous
</a></nav>
        <nav class="page-nav"><a class="next" href="/rspec/matchers.html">
  Next
</a></nav>
      </article>
    </div>

    <footer>
      <ul>
        <li><a href="http://rubymonstas.org">Ruby Monstas</a></li>
        <li><a href="http://ruby-for-beginners.rubymonstas.org">Ruby For Beginners</a></li>
        <li><a href="http://webapps-for-beginners.rubymonstas.org">Webapps For Beginners</a></li>
        <li><a href="http://testing-for-beginners.rubymonstas.org">Testing For Beginners</a></li>
        <li><a href="mailto:ruby.monsters@gmail.com">Email</a></li>
        <li><a href="https://twitter.com/rubymonsters">Twitter</a></li>
        <li><a href="https://github.com/rubymonsters">GitHub</a></li>
        <li><a href="https://creativecommons.org/licenses/by-sa/2.0/" rel="license cc:license">License</a></li>
        <li><a href="http://foundation.travis-ci.org/imprint/">Imprint</a></li>
      </ul>
    </footer>

    <script src="../assets/javascripts/modernizr-4c875d94.js" type="text/javascript"></script>
    <script src="../assets/javascripts/monstas-79961449.js" type="text/javascript"></script>
  </body>
</html>
